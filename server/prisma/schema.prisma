// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id               Int             @id @default(autoincrement())
  email            String          @unique
  password         String
  name             String?
  createdAt        DateTime        @default(now())
  todaysPoints     Int             @default(0)
  totalpoints      Int             @default(0)
  reqAchivPoints   Int             @default(1000)
  dailies          Daily[]
  weeklies         Weekly[]
  monthlies        Monthly[]
  yearlies         Yearly[]
  tasksdone        DoneTask[]
  savedtaskslist   SavedTaskList[]
  userAchievements Achievements[]
}

model Daily {
  id        Int      @id @default(autoincrement())
  uuid      String   @unique @default(uuid())
  goal      String
  createdAt DateTime @default(now())
  points    Int
  checked   Boolean  @default(false)

  weeklyProgress Float? @default(0)

  // Relations
  user   User @relation(fields: [userId], references: [id])
  userId Int

  weekly     Weekly? @relation(fields: [weeklyUuid], references: [uuid])
  weeklyUuid String?

  monthly     Monthly? @relation(fields: [monthlyUuid], references: [uuid])
  monthlyUuid String?

  yearly     Yearly? @relation(fields: [yearlyUuid], references: [uuid])
  yearlyUuid String?
}

model Weekly {
  id                  Int      @id @default(autoincrement())
  uuid                String   @unique @default(uuid())
  goal                String
  createdAt           DateTime @default(now())
  points              Int
  progress            Float?   @default(0)
  checked             Boolean  @default(false)
  progressBeforeCheck Int? // optional

  monthlyProgress Float? @default(0)

  user   User @relation(fields: [userId], references: [id])
  userId Int

  dailies     Daily[]
  monthly     Monthly? @relation(fields: [monthlyUuid], references: [uuid])
  monthlyUuid String?

  yearly     Yearly? @relation(fields: [yearlyUuid], references: [uuid])
  yearlyUuid String?
}

model Monthly {
  id                  Int      @id @default(autoincrement())
  uuid                String   @unique @default(uuid())
  goal                String
  createdAt           DateTime @default(now())
  points              Int
  progress            Float?   @default(0)
  checked             Boolean  @default(false)
  progressBeforeCheck Int? // optional

  yearlyProgress Float? @default(0)

  user   User @relation(fields: [userId], references: [id])
  userId Int

  weeklies   Weekly[]
  dailies    Daily[]
  yearly     Yearly?  @relation(fields: [yearlyUuid], references: [uuid])
  yearlyUuid String?
}

model Yearly {
  id                  Int      @id @default(autoincrement())
  uuid                String   @unique @default(uuid())
  goal                String
  createdAt           DateTime @default(now())
  points              Int
  progress            Float?   @default(0)
  checked             Boolean  @default(false)
  progressBeforeCheck Int? // optional

  user   User @relation(fields: [userId], references: [id])
  userId Int

  monthlies Monthly[]
  weeklies  Weekly[]
  dailies   Daily[]
}

model DoneTask {
  id             Int      @id @default(autoincrement())
  uuid           String   @unique
  user           User     @relation(fields: [userId], references: [id])
  userId         Int
  type           String // daily, weekly, monthly, yearly
  goal           String
  points         Int
  linkedProgress Int?
  completedAt    DateTime @default(now())
  linkedTo       String? // e.g. linked goal id(s)
  progress       Float? // final progress before completion
  timescompleted Int      @default(1)
}

model SavedTaskList {
  id         Int          @id @default(autoincrement())
  name       String       @default("preset")
  savedtasks SavedTasks[] @relation("ListTasks")
  user       User         @relation(fields: [userId], references: [id])
  userId     Int
}

model SavedTasks {
  id             Int             @id @default(autoincrement())
  uuid           String          @unique
  savedtasks     SavedTaskList[] @relation("ListTasks")
  type           String // daily, weekly, monthly, yearly
  goal           String
  points         Int
  linkedProgress Int?
  linkedTo       String? // e.g. linked goal id(s)
  progress       Float? // final progress before completion
}

model Achievements {
  id          Int     @id @default(autoincrement())
  user        User    @relation(fields: [userId], references: [id])
  userId      Int
  title       String
  description String
  image       String?
  difficulty  String
}
